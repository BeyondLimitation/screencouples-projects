version: '3'

services:
  influxdb:
    image: influxdb:2.4.0
    ports:
    - '8086:8086'
    links:
      - telegraf
    environment:
      - DOCKER_INFLUXDB_INIT_USERNAME=admin
      - DOCKER_INFLUXDB_INIT_PASSWORD=test1234
      - DOCKER_INFLUXDB_INIT_ORG=screencouples
      - DOCKER_INFLUXDB_INIT_BUCKET=networks
      - DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=security-t0ken
    volumes:
      - type: volume
        source: influxdb
        target: /etc/influxdb2/
  telegraf:
    image: telegraf:1.24
    ports:
      - '8092:8092'
      - '8094:8094'
    links:
      - influxdb
    volumes:
      - type: bind
        source: ./telegraf/telegraf.toml
        target: /etc/telegraf/telegraf.toml
      - type: bind
        source: ./vyos_mibs/
        target: /usr/share/snmp/mibs/
    entrypoint: 'telegraf --config /etc/telegraf/telegraf.toml'
    depends_on: 
      - influxdb

networks:
  monitoring:
    name: screencouples-monitoring

volumes:
  influxdb:
